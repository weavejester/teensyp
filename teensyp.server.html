<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>teensyp.server documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Teensyp</span> <span class="project-version">0.3.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>teensyp</span></div></div></li><li class="depth-2 branch"><a href="teensyp.buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffer</span></div></a></li><li class="depth-2 branch"><a href="teensyp.channel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>channel</span></div></a></li><li class="depth-2 current"><a href="teensyp.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="teensyp.server.html#var-CLOSE"><div class="inner"><span>CLOSE</span></div></a></li><li class="depth-1"><a href="teensyp.server.html#var-PAUSE-READS"><div class="inner"><span>PAUSE-READS</span></div></a></li><li class="depth-1"><a href="teensyp.server.html#var-RESUME-READS"><div class="inner"><span>RESUME-READS</span></div></a></li><li class="depth-1"><a href="teensyp.server.html#var-start-server"><div class="inner"><span>start-server</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">teensyp.server</h1><div class="doc"><div class="markdown"><p>The main server namespace.</p>
</div></div><div class="public anchor" id="var-CLOSE"><h3>CLOSE</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A unique identifier that can be passed to the write function of a handler in order to close the connection.</p>
</div></div></div><div class="public anchor" id="var-PAUSE-READS"><h3>PAUSE-READS</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A unique identifier that can be passed to the write function of a handler in order to pause reads. See: <a href="teensyp.server.html#var-RESUME-READS">RESUME-READS</a>.</p>
</div></div></div><div class="public anchor" id="var-RESUME-READS"><h3>RESUME-READS</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A unique identifier that can be passed to the write function of a handler in order to pause reads. See: <a href="teensyp.server.html#var-PAUSE-READS">PAUSE-READS</a>.</p>
</div></div></div><div class="public anchor" id="var-start-server"><h3>start-server</h3><div class="usage"><code>(start-server {:keys [port executor], :as opts})</code></div><div class="doc"><div class="markdown"><p>Start a TCP server with the supplied map of options:</p>
<ul>
<li><code>:port</code> - the port number to listen on (mandatory)</li>
<li><code>:handler</code> - a handler function (mandatory, see below)</li>
<li><code>:executor</code> - a custom ExecutorService to supply worker threads</li>
<li><code>:read-buffer-size</code> - the read buffer size in bytes (default 8K)</li>
<li><code>:write-buffer-size</code> - the write buffer size in bytes (default 32K)</li>
<li><code>:write-queue-size</code> - the max number of writes in the queue (default 64)</li>
</ul>
<p>The handler function must have three arities:</p>
<pre><code>(fn handler
  ([write] initial-state)           ;; on socket accept
  ([state buffer write] new-state)  ;; on socket read data
  ([state exception]))              ;; on socket close
</code></pre>
<p>The <code>buffer</code> is a java.nio.ByteBuffer instance, and <code>write</code> is a function that takes a buffer as an argument and will queue it to send to the client. To close the channel, pass <a href="teensyp.server.html#var-CLOSE">CLOSE</a> to the write function.</p>
<p>The write function may also take <a href="teensyp.server.html#var-PAUSE-READS">PAUSE-READS</a> and <a href="teensyp.server.html#var-RESUME-READS">RESUME-READS</a>. These will pause and resume reads calls respectively.</p>
<p>You may optionally specify a second argument to <code>write</code>. This is should be a zero-argument callback function, which is called after the write completes.</p>
<p>The <code>state</code> is a custom data structure that is returned when the accept or read arities are triggered. A different state is associated with each connection.</p>
<p>When closing, the <code>exception</code> may contain the exception that terminated the channel, or <code>nil</code> if the channel were terminated gracefully.</p>
<p>The handler function is guaranteed to execute in serial per channel. That is, the accept will always be first, the close will always be last, and reads will always be sequential.</p>
</div></div></div></div></body></html>